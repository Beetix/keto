---
title: Checking whether a Subject has a Relation
---

import Mermaid from "@theme/Mermaid";
import RelationTuplePrism from '@theme/RelationTuplePrism'
RelationTuplePrism()

This guide will explain how you can use Ory Keto's [check API](/TODO)
to determine whether a [subject](../concepts/sujects) has a specific
[relation](../concepts/relation-tuples) on an [object](../concepts/objects).
The result can be used for controlling access to specific resources.

## Per-Request Flow

We recommend offloading the whole burden of access control to
Ory Keto. Typically, this means that the application forwards every incoming request
as a check request to Ory Keto. The following chart demonstrates how such a flow
can look like:

<Mermaid
  chart={`
sequenceDiagram
    participant U as User 'john'
    participant A as Application
    participant K as Ory Keto
    U->>A: decypher(02y_15_4w350m3)
    A->>K: check(02y_15_4w350m3#35;decypher@john)
    alt is allowed
      K-->>A: true
      A-->>U: ory_is_awesome
    else is not allowed
      K-->>A: false
      A--xU: Error 404
    end
`}
/>

As a first step, the application has to authenticate the user reliably
to provide the subject to Keto. This can be achieved e.g. by using
[Ory Kratos](/TODO) or any other authentication system.

The request (here `decypher` of `02y_15_4w350m3`) is then translated into
a request to Ory Keto's [check API](/TODO). Basically, the application
is asking Keto "Is john allowed to decypher the text 02y_15_4w350m3?"
This is encoded as the following [relation tuple](../concepts/relation-tuples):

```keto-relation-tuples
02y_15_4w350m3#decypher@john
```

Note that the channel of communication between user <-> application, and application <-> Ory Keto
can vastly differ. The application could offer a JSON API towards the user, while communicating
with Keto through gRPC.

## Caching Keto's responses

We do not recommend that you cache the responses from Ory Keto. It is designed to
respond quickly and still provide [some consistency guarantees](/TODO). Especially,
for the revocation of access it is important to not use a local cache. Be ensured
that Ory Keto heavily utilizes caching wherever possible. If you still happen to
find unacceptably slow check requests, check that you follow our [best practices for good performance](/TODO),
or open an issue if the problem still persists.
